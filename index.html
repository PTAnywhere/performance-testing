<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>PTAnywhere performance testing by PTAnywhere</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
    <script src="Chart.Scatter.min.js"></script>
    <script src="results.js"></script>
    <script>
      var lineChart = (function () {
          //Source: http://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable
          function humanFileSize(bytes, si) {
            var thresh = si ? 1000 : 1024;
            if(Math.abs(bytes) < thresh) {
                return bytes + ' B';
            }
            var units = si
                ? ['kB','MB','GB','TB','PB','EB','ZB','YB']
                : ['KiB','MiB','GiB','TiB','PiB','EiB','ZiB','YiB'];
            var u = -1;
            do {
                bytes /= thresh;
                ++u;
            } while(Math.abs(bytes) >= thresh && u < units.length - 1);
            return bytes.toFixed(1)+' '+units[u];
          }

          function humanTime(value, unit='ns') {
            var thresh = 1000;
            var units = ['ns', 'us','ms','s'];
            var u = units.indexOf(unit);

            if (u==-1) {
              console.error('Invalid units.');
              return;
            }

            if(Math.abs(value) < thresh) {
                return value + unit;
            }
            do {
                value /= thresh;
                ++u;
            } while(Math.abs(value) >= thresh && u < units.length - 1);
            return value.toFixed(1)+' '+units[u];
          }

          /* Begin ChartFactory */
          function ChartFactory(canvasId, additionalOptions) {
            this(canvasId, additionalOptions, null);
          }

          function ChartFactory(canvasId, additionalOptions, data) {
            this.canvasId = canvasId;
            this.opts = getOptions(additionalOptions);
            this.datasets = [];
            if (data!=null)
              this.datasets.push({label: 'First approach', data: data});
          }

          function getOptions(additionalOptions) {
            var options = {
              animation: false,
              scaleStartValue: 0,
              scaleShowVerticalLines: true,
              tooltipTemplate: "<%=valueLabel%> (with <%=argLabel%> containers)",
              legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><%for(var i=0;i<datasets.length;i++){%><li><span class=\"<%=name.toLowerCase()%>-legend-marker\" style=\"background-color:<%=datasets[i].strokeColor%>\"></span><%=datasets[i].label%></li><%}%></ul>"
            };
            if (typeof additionalOptions!=='undefined') {
              for (var key in additionalOptions) {
                options[key] = additionalOptions[key];
              }
            }
            return options;
          }

          ChartFactory.prototype.add = function(dataset) {
            this.datasets.push(dataset);
            return this;
          };

          ChartFactory.prototype.build = function(data) {
            var ctx = document.getElementById(this.canvasId).getContext('2d');
            var data = {datasets: this.datasets};
            var chart = new Chart(ctx).Scatter(data, getOptions(this.opts));
            $('#' + this.canvasId).after('<div id="legend-' + this.canvasId + '">' + chart.generateLegend()+ '</div>');
            return chart;
          };
          /* End ChartFactory */

          return {
              Factory: ChartFactory,
              humanizeSize: humanFileSize,
              humanizeTime: humanTime,
          };
      })();  // End defaultLineChart module

      $(function() {
        new lineChart.Factory('diskChart', { scaleLabel: '<%=lineChart.humanizeSize(value, true)%>' }, results.size).build();
        new lineChart.Factory('responseTime', { scaleLabel: '<%=lineChart.humanizeTime(value, "ms")%>' }, results.response).build();
        new lineChart.Factory('cpuTotal', { scaleLabel: '<%=lineChart.humanizeTime(value)%>' },  results.cpu_total).build();
        new lineChart.Factory('cpuPercentage', { scaleLabel: '<%=value%>%' }, results.cpu_percentage).build();
        mu = new lineChart.Factory('memoryUsage', { scaleLabel: '<%=lineChart.humanizeSize(value, false)%>' }).
            add({label: 'First approach', data: results.memory}).
            add({label: 'First approach (max)', data: results.memory_max, strokeColor: 'red'}).build();
        new lineChart.Factory('memoryPercentage', { scaleLabel: '<%=value%>%' }, results.memory_percentage).build();
      });
    </script>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">PTAnywhere performance testing</h1>
      <h2 class="project-tagline">Project created to measure the performance of the Docker-based Packet Tracer.</h2>
      <a href="https://github.com/PTAnywhere/performance-testing" class="btn">View on GitHub</a>
      <a href="https://github.com/PTAnywhere/performance-testing/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/PTAnywhere/performance-testing/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>The <strong>performance-testing</strong> project analyses how well the Docker-based Packet Tracer solution proposed in <a href="http://ptanywhere.github.io">PTAnywhere</a> can scale.</p>
      <p>This page will be updated with the test results.</p>
      <p>The tests will check what happens in the system when N Packet Tracer instances are running simultaneously.</p>

      <h1><a id="disk-size" class="anchor" href="#disk-size" aria-hidden="true"><span class="octicon octicon-link"></span></a>Disk size demanded</h1>
      <p>The following chart shows the disk needed by Docker to store a container after running it.
        During the execution they require significantly less disk space.
        Note that storing the container after its execution might not be always a desired feature.
        If it is not, Docker will get rid of the resources allocated.</p>
      <canvas id="diskChart" width="600" height="400"></canvas>

      <h1><a id="response-time" class="anchor" href="#response-time" aria-hidden="true"><span class="octicon octicon-link"></span></a>Response time</h1>
      <p>The following chart shows the time needed to contact a Packet Tracer instance
        after its container has been started.</p>
      <canvas id="responseTime" width="600" height="400"></canvas>

      <h1><a id="cpu-usage" class="anchor" href="#cpu-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>CPU usage</h1>
      <h2>CPU total usage</h2>
      <p>The following chart shows the summatory of the CPU time allocated by each container during their lifetime (around 5 seconds).</p>
      <canvas id="cpuTotal" width="600" height="400"></canvas>
      <h2>CPU percentual usage</h2>
      <canvas id="cpuPercentage" width="600" height="400"></canvas>

      <h1><a id="memory-usage" class="anchor" href="#memory-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Memory usage</h1>
      <h2>Memory usage</h2>
      <p>The following chart shows the summatory of the memory usage recorded for each container and the maximum memory usage.</p>
      <canvas id="memoryUsage" width="600" height="400"></canvas>
      <h2>Memory percentual usage</h2>
      <p>Note: the machine where it has been tested has 125 GiBs.</p>
      <canvas id="memoryPercentage" width="600" height="400"></canvas>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/PTAnywhere/performance-testing">PTAnywhere performance testing</a> is maintained by <a href="https://github.com/PTAnywhere">PTAnywhere</a>.</span>
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>
    </section>
  </body>
</html>
